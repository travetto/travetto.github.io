<h1 id="pool">Pool</h1>
<p>This module provides an API for dealing with pools of elements, and special attention is given to pools that<br>are used for managing jobs as opposed to simple resources.</p>
<p>The module wraps around <a class="external-link" href="https://github.com/coopernurse/node-pool" target="_blank" null><code>generic-pool</code></a> as a base for the pooling mechanism.</p>
<p>With respect to managing jobs, <a class="source-link" href="https://githhub.com/travetto/pool/tree/master/src/concurrent/concurrent.ts" target="_blank" null><code>ConcurrentPool</code></a> is provided to allow for concurrent operation, and processing of jobs<br>as quickly as possible.</p>
<p>To manage the flow of jobs, there are various <a class="source-link" href="https://githhub.com/travetto/pool/tree/master/src/concurrent/types.ts" target="_blank" null><code>DataSource</code></a> implementation that allow for a wide range of use cases.</p>
<p>The supported <code>DataSource</code>s are</p>
<ul>
<li><code class="inline language-typescript">Array</code> is a list of jobs, will execute in order until list is exhausted. </li>
<li><code class="inline language-typescript">Queue</code> is similar to list but will execute forever waiting for new items to be added to the queue.</li>
<li><code class="inline language-typescript">Iterator</code> is a generator function that will continue to produce jobs until the iterator is exhausted.</li>
</ul>
<p>Below is a pool that will convert images on demand, while queuing as needed.</p>
<pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">ImageProcessor</span> <span class="token punctuation">{{ '{' }}</span>
  active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  proc<span class="token punctuation">:</span> ChildProcess<span class="token punctuation">;</span>

  <span class="token function">kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>proc<span class="token punctuation">.</span><span class="token function">kill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">convert</span><span class="token punctuation">(</span>path<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{{ '{' }}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>proc <span class="token operator">=</span> <span class="token operator">...</span>convert <span class="token operator">...</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>proc<span class="token punctuation">;</span>
    <span class="token punctuation">{{ '}' }}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">e</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>

    <span class="token punctuation">{{ '}' }}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span>

<span class="token keyword">class</span> <span class="token class-name">ImageCompressor</span> <span class="token punctuation">{{ '{' }}</span>
  pendingImages<span class="token punctuation">:</span> QueueDataSource<span class="token operator">&lt;</span><span class="token builtin">string</span><span class="token operator">></span><span class="token punctuation">;</span>

  pool <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcurrentPool</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ImageProcessor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>pool<span class="token punctuation">.</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>pendingImages<span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>inp<span class="token punctuation">,</span> exe<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{ '{' }}</span>
      exe<span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span>inp<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  <span class="token function">convert</span><span class="token punctuation">(</span><span class="token operator">...</span>images<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> img <span class="token keyword">of</span> images<span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pendingImages<span class="token punctuation">.</span><span class="token function">enqueue</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{ '}' }}</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre>
