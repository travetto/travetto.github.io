<h1 id="travetto-asset">Asset</h1>
<p>This module provides the framework for storing/retrieving assets. It also provides additional image functionality for on-the-fly resizing. </p>
<p><a class="external-link" target="_blank" href="http://www.graphicsmagick.org"><code>GraphicsMagick</code></a> is used under the covers for image transformation.  If the binary is not installed the framework will spin up a <a class="external-link" target="_blank" href="https://www.docker.com/community-edition"><code>docker</code></a> container to provide needed functionality.</p>
<p>The primary driver for the Asset framework is an <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/source.ts"><code>AssetSource</code></a> which needs to be implemented 
to provide code on how to read and write files.  </p>
<p>Initially you need to configure the <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/source.ts"><code>AssetSource</code></a> to provide a backend for the storage and retrieval. Below we are using the <a class="module-link" routerLink="/docs/asset-mongo"><code>Asset-Mongo</code></a> as the
backend, but there are others to choose from.</p>
<pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">AppConfig</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">getConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> AssetMongoConfig <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AssetMongoConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">getSource</span><span class="token punctuation">(</span>cfg<span class="token punctuation">:</span> AssetMongoConfig<span class="token punctuation">)</span><span class="token punctuation">:</span> AssetSource <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">AssetMongoSource</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre>
<p>After that, both <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/asset.ts"><code>AssetService</code></a> and <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/image.ts"><code>ImageService</code></a> 
will rely upon the <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/source.ts"><code>AssetSource</code></a> to do their work.  Below you can see an example of storing and retrieving a user&#39;s profile image.<br>Storing of all assets goes through the <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/asset.ts"><code>AssetService</code></a>, but retrieval can either 
be from <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/asset.ts"><code>AssetService</code></a> or <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/image.ts"><code>ImageService</code></a> depending on whether or not you want to perform
image optimizations on retrieval.</p>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserProfileService</span> <span class="token punctuation">{{ '{' }}</span>

  <span class="token keyword">constructor</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> asset<span class="token punctuation">:</span> AssetService<span class="token punctuation">,</span> 
    <span class="token keyword">private</span> image<span class="token punctuation">:</span> ImageService<span class="token punctuation">,</span>
    <span class="token keyword">private</span> model<span class="token punctuation">:</span> ModelService
  <span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span><span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">saveProfileImage</span><span class="token punctuation">(</span>userId<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">,</span> image<span class="token punctuation">:</span> Asset<span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>asset<span class="token punctuation">.</span><span class="token function">store</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    user<span class="token punctuation">.</span>profileImage <span class="token operator">=</span> path<span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>User<span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">getProfileImage</span><span class="token punctuation">(</span>userId<span class="token punctuation">:</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>image<span class="token punctuation">.</span><span class="token function">getImage</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>profileImage<span class="token punctuation">,</span> <span class="token punctuation">{{ '{' }}</span> w<span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">,</span> h<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre>
<p>The current set of supported <a class="source-link" target="_blank" href="https://github.com/travetto/asset/tree/master/src/service/source.ts"><code>AssetSource</code></a> implementations are:</p>
<ul>
<li><a class="module-link" routerLink="/docs/asset-mongo"><code>Asset-Mongo</code></a> provides the mongodb driver for file management</li>
<li><a class="module-link" routerLink="/docs/asset-s3"><code>Asset-S3</code></a> provides the S3 driver for file management</li>
</ul>


