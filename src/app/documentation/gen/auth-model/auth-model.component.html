<div class="documentation"><h2 id="auth-model" id="auth-model">Auth-Model</h2>
<app-section-header headerType="install">Model provider</app-section-header>
<pre><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> @travetto/auth-model</code></pre><p>This module provides the integration between the <a class="module-link" routerLink="/docs/auth"  null><code class="inline">Auth</code></a> module and the <a class="module-link" routerLink="/docs/model"  null><code class="inline">Model</code></a>.</p>
<p>The module itself is fairly straightforward, and truly the only integration point for this module to work is defined at the model level.  The contract for authentication is established in code:</p>
<app-section-header headerType="code">Structure of auth principal provider</app-section-header>
<pre><code class="language-typescript">@<span class="token meta">Model</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">extends</span> <span class="token class-name">BaseModel</span> <span class="token punctuation">{{ '{' }}</span>
  password<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  salt<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  hash<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  resetToken<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  resetExpires<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token type">Date</span><span class="token punctuation">;</span>
  permissions<span class="token operator">?</span><span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span>

<span class="token keyword">class</span> <span class="token class-name">AuthConfig</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">getAuthModelProvider</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token type">PrincipalProvider</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">new</span> <span class="token class-name">ModelPrincipalProvider</span><span class="token punctuation">(</span>
      <span class="token type">User</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>u<span class="token punctuation">:</span><span class="token type">User</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span><span class="token punctuation">{{ '{' }}</span>
        provider<span class="token punctuation">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span>
        id<span class="token punctuation">:</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        permissions<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>permissions<span class="token punctuation">)</span><span class="token punctuation">,</span>
        hash<span class="token punctuation">:</span> u<span class="token punctuation">.</span>hash<span class="token punctuation">,</span>
        salt<span class="token punctuation">:</span> u<span class="token punctuation">.</span>salt<span class="token punctuation">,</span>
        resetToken<span class="token punctuation">:</span> u<span class="token punctuation">.</span>resetToken<span class="token punctuation">,</span>
        resetExpires<span class="token punctuation">:</span> u<span class="token punctuation">.</span>resetExpires<span class="token punctuation">,</span>
        password<span class="token punctuation">:</span> u<span class="token punctuation">.</span>password<span class="token punctuation">,</span>
        details<span class="token punctuation">:</span> u<span class="token punctuation">,</span>
      <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span>u<span class="token punctuation">:</span><span class="token type">Identity</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token type">User</span><span class="token punctuation">.</span><span class="token keyword">from</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{{ '{' }}</span>
        id<span class="token punctuation">:</span> u<span class="token punctuation">.</span>id<span class="token punctuation">,</span>
        permissions<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">(</span>u<span class="token punctuation">.</span>permissions<span class="token operator">||</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        hash<span class="token punctuation">:</span> u<span class="token punctuation">.</span>hash<span class="token punctuation">,</span>
        salt<span class="token punctuation">:</span> u<span class="token punctuation">.</span>salt<span class="token punctuation">,</span>
        resetToken<span class="token punctuation">:</span> u<span class="token punctuation">.</span>resetToken<span class="token punctuation">,</span>
        resetExpires<span class="token punctuation">:</span> u<span class="token punctuation">.</span>resetExpires<span class="token punctuation">,</span>
      <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><p>As you can see, to use the <code class="inline">ModelProvider</code>, you need to provide mapping functions to convert between the <code class="inline">Principal</code> model, and the underlying model.  Below is an example of what using the provider would look like:</p>
<app-section-header headerType="code">Sample usage</app-section-header>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token operator">...</span>

  @<span class="token meta">Inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> auth<span class="token punctuation">:</span> <span class="token type">ModelPrincipalProvider</span><span class="token operator">&lt;</span><span class="token type">User</span><span class="token operator">></span><span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">:</span> <span class="token type">User</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> created <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>auth<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">await</span>  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendRegistrationEmail</span><span class="token punctuation">(</span>created<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> created<span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  <span class="token operator">...</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></div>