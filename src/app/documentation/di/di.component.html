<div class="documentation"><h1 id="dependency-injection-">Dependency Injection  </h1>
<p>Dependency injection is provided as a best practice, and as a framework primitive. Dependency injection<br>can be achieved in multiple ways to support different software patterns. Dependency injection only supports<br>classes as the class is the lookup key.</p>
<h2 id="general-usage">General Usage</h2>
<p>Dependency injection revolves around the following paradigms:</p>
<ul>
<li><code class="decorator">@Injectable</code> decorator denotes that a class can be injected.<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">CustomService</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">async</span> <span class="token function">coolOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token operator">...</span> work <span class="token operator">...</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></li>
<li><code class="decorator">@InjectableFactory</code> decorator denotes a static class method that produces an <code class="decorator">@Injectable</code><pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">initService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> CoolService <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CoolService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></li>
<li><p><code class="decorator">@Inject</code> decorator denotes a desire to inject a value directly</p>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">CustomService</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">Inject</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> dependentService<span class="token punctuation">:</span> DependentService<span class="token punctuation">;</span>

  <span class="token keyword">async</span> <span class="token function">coolOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dependentService<span class="token punctuation">.</span><span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></li>
<li><p><code class="decorator">@Injectable</code> constructor params</p>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">CustomService</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">constructor</span> <span class="token punctuation">(</span><span class="token keyword">private</span> dependentService<span class="token punctuation">:</span> DependentService<span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span><span class="token punctuation">{{ '}' }}</span>

  <span class="token keyword">async</span> <span class="token function">coolOperation</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>dependentService<span class="token punctuation">.</span><span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></li>
<li><code class="decorator">@InjectableFactory</code> params <pre><code class="language-typescript"><span class="token keyword">class</span> <span class="token class-name">Config</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">static</span> <span class="token function">initService</span><span class="token punctuation">(</span>dependentService<span class="token punctuation">:</span> DependentService<span class="token punctuation">)</span><span class="token punctuation">:</span> CustomService <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">CustomService</span><span class="token punctuation">(</span>dependentService<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></li>
</ul>
<h2 id="manual-invocation">Manual Invocation</h2>
<p>Some times you will need to lookup a dependency dynamically, or you want to control the injection process at a more granular level.<br>To achieve that you will need to directly access the <a class="source-link" href="https://githhub.com/travetto/di/tree/master/src/service/registry.ts" target="_blank" null><code>DependencyRegistry</code></a>.</p>
<p>The registry allows for requesting a dependency by class reference.</p>
<pre><code class="language-typescript">@<span class="token meta">Injectable</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Complex</span> <span class="token punctuation">{{ '{' }}</span><span class="token punctuation">{{ '}' }}</span>

<span class="token keyword">class</span> <span class="token class-name">ManualLookup</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">async</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> complex <span class="token operator">=</span> <span class="token keyword">await</span> DependencyRegistry<span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span>Complex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><h2 id="advanced-usage">Advanced Usage</h2>
<p>In addition to the standard operations, you are able to create multiple versions of the same dependency by providing a qualifier at registration time and<br>at injection time.  This allows you to have multiple database connections, or multiple email services.</p>
<pre><code class="language-typescript"><span class="token keyword">const</span> <span class="token constant">USER_DB</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'USER_DB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">ASSET_DB</span> <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'ASSET_DB'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">DBConfig</span> <span class="token punctuation">{{ '{' }}</span>
  host<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span>

<span class="token keyword">class</span> <span class="token class-name">Factory</span> <span class="token punctuation">{{ '{' }}</span>
  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token constant">USER_DB</span><span class="token punctuation">)</span>
  <span class="token function">getUserConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> DBConfig <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DBConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conf<span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token string">'user'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> conf<span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

  @<span class="token meta">InjectableFactory</span><span class="token punctuation">(</span><span class="token constant">USER_DB</span><span class="token punctuation">)</span>
  <span class="token function">getAssetConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> DBConfig <span class="token punctuation">{{ '{' }}</span>
    <span class="token keyword">const</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DBConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    conf<span class="token punctuation">.</span>host <span class="token operator">=</span> <span class="token string">'asset'</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> conf<span class="token punctuation">;</span>
  <span class="token punctuation">{{ '}' }}</span>

<span class="token punctuation">{{ '}' }}</span>

<span class="token keyword">class</span> <span class="token class-name">UserService</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">constructor</span><span class="token punctuation">(</span>@<span class="token meta">Inject</span><span class="token punctuation">(</span><span class="token constant">USER_DB</span><span class="token punctuation">)</span> config<span class="token punctuation">:</span>DBConfig<span class="token punctuation">)</span> <span class="token punctuation">{{ '{' }}</span><span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></div>
