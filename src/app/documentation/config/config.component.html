<div class="documentation"><h1 id="config-">Config </h1>
<p>The config module provides support for loading application config on startup. Configuration values support all valid <a class="external-link" href="https://en.wikipedia.org/wiki/YAML" target="_blank" null><code>yaml</code></a> constructs.</p>
<h2 id="resolution">Resolution</h2>
<p>Config loading follows a defined resolution path:</p>
<ol>
<li><p>Load framework module configurations.  Defines general configuration that should be easily overridden.</p>
<pre><code class="language-bash">node_modules/@travetto/<span class="token operator">&lt;</span>module<span class="token operator">></span>/config/*.yml</code></pre></li>
<li><p>Load local application configurations</p>
<pre><code class="language-bash">config/*.yml</code></pre></li>
<li><p>Load environment specific configurations as defined by the values in <code>process.env.ENV</code></p>
<pre><code class="language-properties"><span class="token attr-name">process.env.ENV</span><span class="token punctuation">=</span><span class="token attr-value">&lt;val1>,&lt;val2>...</span></code></pre><p>would load</p>
<pre><code class="language-bash">env/<span class="token operator">&lt;</span>val1<span class="token operator">></span>.yml
env/<span class="token operator">&lt;</span>val2<span class="token operator">></span>.yml</code></pre></li>
</ol>
<ol start="4">
<li>Read startup configuration from <code>process.env</code> to allow for overriding any values. Because we are overriding a<a class="external-link" href="https://en.wikipedia.org/wiki/YAML" target="_blank" null><code>yaml</code></a> based configuration<br>we need to compensate for the differences in usage patterns.  Generally all environment variables are passed in as <code>UPPER_SNAKE_CASE</code>.<br>When reading from <code>process.env</code> we will map <code>UPPER_SNAKE_CASE</code> to <code>upper.snake.case</code>, and will attempt to match by case-insensitive name.</li>
</ol>
<h2 id="example-resolution">Example Resolution</h2>
<p>A more complete example setup would look like:</p>
<p><code class="path">config/database.yml</code></p>
<pre><code class="language-yaml"><span class="token key atrule">database</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9423</span>
  <span class="token key atrule">creds</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> test
    <span class="token key atrule">password</span><span class="token punctuation">:</span> test</code></pre><p><code class="path">env/prod.yml</code></p>
<pre><code class="language-yaml"><span class="token key atrule">database</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>host<span class="token punctuation">-</span>db
  <span class="token key atrule">creds</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> admin<span class="token punctuation">-</span>user</code></pre><p>with environment variables</p>
<pre><code class="language-properties"><span class="token attr-name">ENV</span><span class="token punctuation">=</span><span class="token attr-value">prod</span>
<span class="token attr-name">DATABASE_PORT</span><span class="token punctuation">=</span><span class="token attr-value">1234</span>
<span class="token attr-name">DATABASE_CREDS_PASSWORD</span><span class="token punctuation">=</span><span class="token attr-value">&lt;secret></span></code></pre><p>At runtime the resolved config would be:</p>
<pre><code class="language-yaml"><span class="token key atrule">database</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> prod<span class="token punctuation">-</span>host<span class="token punctuation">-</span>db
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">1234</span>
  <span class="token key atrule">creds</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> admin<span class="token punctuation">-</span>user
    <span class="token key atrule">password</span><span class="token punctuation">:</span> &lt;secret<span class="token punctuation">></span></code></pre><h2 id="reading">Reading</h2>
<p>The module provides a decorator, <code class="decorator">@Config</code> that allows for classes to automatically be bound with config information<br>on post construction. The decorator will install a <code>postConstruct</code> method if not already defined, that allows actually performs<br>the binding of configuration.  </p>
<p>The decorator takes in a namespace, of what part of the resolved configuration you want to bind to your class. Given the following class</p>
<pre><code class="language-typescript">@<span class="token meta">Config</span><span class="token punctuation">(</span><span class="token string">'database'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">DBConfig</span> <span class="token punctuation">{{ '{' }}</span>
  <span class="token keyword">private</span> host<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> port<span class="token punctuation">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  <span class="token keyword">private</span> creds <span class="token operator">=</span> <span class="token punctuation">{{ '{' }}</span>
    user<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">''</span>
  <span class="token punctuation">{{ '}' }}</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ '}' }}</span></code></pre><p>And the corresponding config file</p>
<pre><code class="language-yaml"><span class="token key atrule">database</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> localhost
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9423</span>
  <span class="token key atrule">creds</span><span class="token punctuation">:</span>
    <span class="token key atrule">user</span><span class="token punctuation">:</span> bob
    <span class="token key atrule">password</span><span class="token punctuation">:</span> bobspw</code></pre><p>The instance of <code>DBConfig</code>  would be equivalent to:</p>
<pre><code class="language-js"><span class="token punctuation">{{ '{' }}</span>
  host<span class="token punctuation">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  port<span class="token punctuation">:</span> <span class="token number">9423</span><span class="token punctuation">,</span>
  creds <span class="token punctuation">:</span> <span class="token punctuation">{{ '{' }}</span>
    user<span class="token punctuation">:</span> <span class="token string">'bob'</span><span class="token punctuation">,</span>
    password<span class="token punctuation">:</span> <span class="token string">'bobspw'</span>
  <span class="token punctuation">{{ '}' }}</span>
<span class="token punctuation">{{ '}' }}</span></code></pre></div>
