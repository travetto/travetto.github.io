<h1 id="travetto-base">Base</h1>
<p>Base is the foundation of all <code>travetto</code> applications.  It is intended to be a minimal application bootstrap, as well as support
for commonly shared functionality. The key areas that it offers</p>
<h2 id="general-app-info">General App Info</h2>
<p>This is a programmatic interface to <code>package.json</code>, which provides key information on:</p>
<ul>
<li>Application Name</li>
<li>Version</li>
<li>Package</li>
<li>Development Dependencies</li>
<li>...more</li>
</ul>
<h2 id="bulk-file-system-operations">Bulk File System Operations</h2>
<p>The framework does a bit of file system scanning to auto load files, and to have knowledge of what files are
available. The tools provide:</p>
<ul>
<li>Very simple functionality for recursively finding files, and caching the results</li>
<li>Utilizes RegEx in lieu of glob for pattern matching on files (this is to minimize overall code complexity)</li>
</ul>
<p>A simple example of finding all <code>.config</code> files in your codebase:</p>
<pre><code class="language-typescript">  <span class="token keyword">function</span> <span class="token function">processServiceConfigs</span><span class="token punctuation">(</span>svc<span class="token punctuation">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
    <span class="token keyword">const</span> svcConfigs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">findAppFiles</span><span class="token punctuation">(</span><span class="token string">'.config'</span><span class="token punctuation">,</span> file <span class="token operator">=></span> path<span class="token punctuation">.</span><span class="token function">basename</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${{ "{" }}</span>svc<span class="token interpolation-punctuation punctuation">{{ "}" }}</span></span><span class="token string">.`</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> conf <span class="token keyword">of</span> svcConfigs<span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
      <span class="token operator">...</span> <span class="token keyword">do</span> work
    <span class="token punctuation">{{ "}" }}</span>
  <span class="token punctuation">{{ "}" }}</span></code></pre>
<h2 id="environmental-information">Environmental Information</h2>
<p>The framework provides basic environment information, e.g. in prod/test/dev.  This is useful for runtime decisions.  This is primarily used
by the framework, but can prove useful to application developers as well. The information that is available is:</p>
<ul>
<li><code>prod: boolean</code> - is the application in prod mode </li>
<li><code>dev: boolean</code> - is the application in development mode</li>
<li><code>test: boolean</code> - is the application currently in test mode</li>
<li><code>watch: boolean</code> - is the application currently watching for file changes and reloads (normally only during development)</li>
<li><code>all: string[]</code> - a list of all the environments that are passed in and configured</li>
<li><code>docker: boolean</code> - does the environment support docker, and should it use it if needed</li>
<li><code>debug: boolean</code> - is the application currently in debug mode</li>
<li><code>trace: boolean</code> - is the application currently in trace mode</li>
<li><code>cwd: string</code> - what is the root folder of the application</li>
</ul>
<h2 id="shutdown">Shutdown</h2>
<p>This is centralized functionality for running operations on shutdown.  Primarily used by the framework for cleanup operations, this provides a clean interface for registering shutdown handlers and awaiting shutdown to finish.</p>
<p>As a registered handler, you can do.</p>
<pre><code class="language-typescript">Shutdown<span class="token punctuation">.</span><span class="token function">onShutdown</span><span class="token punctuation">(</span><span class="token string">'handler-name'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{ "{" }}</span>
  <span class="token comment">// Do important work</span>
<span class="token punctuation">{{ "}" }}</span><span class="token punctuation">)</span></code></pre>
<p>If knowing when shutdown finishes is all you want, you can simply use:</p>
<pre><code class="language-typescript"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">messageOnShutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
  <span class="token keyword">await</span> Shutdown<span class="token punctuation">.</span><span class="token function">onShutdownPromise</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Shutdown is complete!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ "}" }}</span></code></pre>
<h2 id="stacktrace">Stacktrace</h2>
<p>Integration with <code>trace.js</code> to handle asynchronous call stacks, and provide higher quality stack traces.  The stack filtering will remove duplicate or unnecessary lines, as well as filter out framework specific steps that do not aid in debugging.  The final result should be a stack trace that is concise and clear.</p>
<p>From a test scenario:</p>
<pre><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">inner1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">inner2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">inner3</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{{ "{" }}</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Uh oh'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">{{ "}" }}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">{{ "}" }}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">{{ "}" }}</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">{{ "}" }}</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Will produce the following stack trace:</p>
<pre><code>Error: Uh oh
    at Timeout.inner3 [as _onTimeout] (./test/stack.js:6:23)
    at Timeout.inner2 [as _onTimeout] (./test/stack.js:5:13)
    at Timeout.inner1 [as _onTimeout] (./test/stack.js:4:9)
    at Object.load [as .ts] (./bin/travetto.js:27:12)</code></pre><h2 id="phase-management">Phase management</h2>
<p>for initializing applications</p>
<ul>
<li>Recursively finds all <code>phase.&lt;phase&gt;.ts</code> files under <code>node_modules/@travetto</code>, and in the root of your project</li>
<li>The export format of each initializer is </li>
</ul>
<pre><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> init <span class="token operator">=</span> <span class="token punctuation">{{ "{" }}</span>
  priority<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token comment">// Lower is of more importance</span>
  action<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">{{ "{" }}</span><span class="token punctuation">{{ "}" }}</span> <span class="token comment">// The action to take to initialize the module/project</span>
<span class="token punctuation">{{ "}" }}</span></code></pre>
<h2 id="util">Util</h2>
<p>Simple functions for providing a minimal facisimile to <code>lodash</code>, but without all the weight.</p>
<h2 id="watch">Watch</h2>
<p>A very simple file watching library, with a substantially smaller footprint than <code>gaze</code> or <code>chokidar</code>.  </p>


